title: 学习《重构手册》
date: 2020-10-15 9:48 PM
categories: 编程
tags: [重构,]

----

## 可度量的异味
### 注释
#### 症状
- 代码中出现注释

#### 原因
作者认为某些内容没有说清楚
- 采用某种做法的原因
- 某种复杂的算法的实现

#### 措施
- 对一个代码块的注释：抽取方法，并用注释为新方法取名
- 对方法所做工作的注释：重命名方法，用注释为方法重命名
- 注释描述的是前提条件或边界：引入断言

#### 收益
可以增强表述能力，有可能暴露出重复性

#### 例外
有些注释是必要的，比如需求文档的链接

### 过长的方法
#### 症状
- 代码块行数很多（个人感觉超过屏幕的高度为多）

#### 原因
没有及时分解代码块，只是一味地在原来的位置增加代码

#### 措施
- 根据代码块的注释和空行和空格，分析前后语义，抽取方法。
- 找到一些重构技术，用于清理直线式代码（ 即大量代码都放在一行上） 、条件式和变量

#### 收益
可以增强表述能力，有可能暴露出重复性，通常有助于建立新的类和抽象。

#### 例外
有些复杂的算法需求，天然需求很多行

### 过大的类
#### 症状
- 代码行数很多
- 大量实例变量
- 大量方法

#### 原因
没有及时根据职责拆分类，只是一味地在原来的类上增加代码。

#### 措施
- 优先解决过长的方法
- 一个新类能承担此类部分职责：抽取类
- 可以划分类和新子类之间的功能的话：抽取子类
- 可以确定客户所用的特性子集：抽取接口

#### 收益
可以增强表述能力，有可能暴露出重复性

#### 例外
无

### 过长的参数表
#### 症状
- 方法有1个或2个以上的参数（个人觉得3个以上）

#### 原因
可能是为了尽量减少对象之间的耦合。这样做不是由被调用对象来了解类之间的关系，而是让调用者来确定所有一切。
也有可能是程序员对例程进行了通用化

#### 措施
- 参数可由已知对象得到：参数替换为方法（调用方法获取改参数）
- 参数来自一个对象：保持对象完整（传递完整对象作为参数）
- 数据不是来自一个逻辑对象：引入参数对象，将其分组（将长参数表变为少量参数对象）

#### 收益
可以增强表述能力，有可能暴露出重复性。通常可以缩小规模。

#### 例外
- 不希望两个类出现依赖
- 参数不存在有意义的分组

## 命名
### 名字中包含类型
#### 症状
- 名字采用复合词，包含类型信息
- 匈牙利记法，如iCount
- 变量名反映的是类型，而不是其用途

#### 原因
- 没有ide的时代，命令包含类型增加了可读性

#### 措施
- 重命名方法
- 重命名字段

#### 收益
可以增强表述能力，有可能暴露出重复性

#### 例外
有些场景命名中的类型是有帮助的，如sql的字段

### 表达力差的名字
#### 症状
- 单字符或双字符
- 无元音的名字
- 带编号的变量，如panel1，panel2
- 奇怪的缩写
- 容易误导的名称

#### 原因
取名没有规范，过于随意

#### 措施
- 重命名方法
- 重命名字段

#### 收益
可以增强表述能力

#### 例外
- i,j,k等循环变量
- 只在几行代码中起作用的单字符变量
- 函数的多个版本实现

